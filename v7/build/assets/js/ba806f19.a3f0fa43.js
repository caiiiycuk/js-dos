"use strict";(self.webpackChunkgh_pages=self.webpackChunkgh_pages||[]).push([[158],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>d});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(r),d=o,f=m["".concat(l,".").concat(d)]||m[d]||c[d]||a;return r?n.createElement(f,i(i({ref:t},u),{},{components:r})):n.createElement(f,i({ref:t},u))}));function d(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},3919:(e,t,r)=>{function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function o(e){return void 0!==e&&!n(e)}r.d(t,{b:()=>n,Z:()=>o})},4996:(e,t,r)=>{r.d(t,{C:()=>a,Z:()=>i});var n=r(2263),o=r(3919);function a(){const{siteConfig:{baseUrl:e="/",url:t}={}}=(0,n.Z)();return{withBaseUrl:(r,n)=>function(e,t,r,{forcePrependBaseUrl:n=!1,absolute:a=!1}={}){if(!r)return r;if(r.startsWith("#"))return r;if((0,o.b)(r))return r;if(n)return t+r;const i=r.startsWith(t)?r:t+r.replace(/^\//,"");return a?e+i:i}(t,e,r,n)}}function i(e,t={}){const{withBaseUrl:r}=a();return r(e,t)}},4767:(e,t,r)=>{r.r(t),r.d(t,{frontMatter:()=>i,contentTitle:()=>s,metadata:()=>l,toc:()=>p,default:()=>c});var n=r(4034),o=(r(7294),r(3905)),a=r(4996);const i={id:"estimating-performance",title:"Esitmating emulators performance"},s=void 0,l={unversionedId:"estimating-performance",id:"estimating-performance",isDocsHomePage:!1,title:"Esitmating emulators performance",description:"Performance testing",source:"@site/docs/estimating-performance.md",sourceDirName:".",slug:"/estimating-performance",permalink:"/v7/build/docs/estimating-performance",editUrl:"https://github.com/caiiiycuk/js-dos/edit/gh-pages/v7/docs/estimating-performance.md",tags:[],version:"current",frontMatter:{id:"estimating-performance",title:"Esitmating emulators performance"},sidebar:"someSidebar",previous:{title:"DOS Janus",permalink:"/v7/build/docs/janus"},next:{title:"Contributing",permalink:"/v7/build/docs/contributing-emulators"}},p=[{value:"Performance testing",id:"performance-testing",children:[]},{value:"Running the test",id:"running-the-test",children:[]},{value:"Implementing the test",id:"implementing-the-test",children:[]}],u={toc:p};function c({components:e,...t}){return(0,o.kt)("wrapper",(0,n.Z)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"performance-testing"},"Performance testing"),(0,o.kt)("p",null,"To measure performance we used a variant of Dhrystone 2 Test originally taken from this ",(0,o.kt)("a",{parentName:"p",href:"http://www.roylongbottom.org.uk/dhrystone%20results.htm"},"page"),". Original version used ",(0,o.kt)("inlineCode",{parentName:"p"},"clock()")," to calculate delta time. Which is good for a real pc, but is not very accurate for a dosbox emulator. When the ",(0,o.kt)("inlineCode",{parentName:"p"},"clock()")," call happened, a modified version sends ",(0,o.kt)("inlineCode",{parentName:"p"},"~>dtime")," marker to stdout which is intercepted by the test page and used to calculate delta time with ",(0,o.kt)("inlineCode",{parentName:"p"},"performance.now()")," from the browser. Source code of the modified test is ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/caiiiycuk/js-dos/tree/6.22/programms/dhry2"},"here"),"."),(0,o.kt)("p",null,"Basically this test produces a lot of int operations and measures the amount of operations (Dhrystones) produced per second. Output is a ",(0,o.kt)("inlineCode",{parentName:"p"},"VAX MIPS RATING")," which is Drhystones per second divided by 1757 (is as DEC VAX 11/780 result)."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"js-dos bundle")," with this test can be found on ",(0,o.kt)("a",{parentName:"p",href:"https://dos.zone/dhrystone-2-test-jul-2020/"},"Test")," page."),(0,o.kt)("h2",{id:"running-the-test"},"Running the test"),(0,o.kt)("p",null,"You can estimate performance of your device ",(0,o.kt)("a",{parentName:"p",href:"https://dos.zone/en/my"},"here"),"."),(0,o.kt)("p",null,"Example output:"),(0,o.kt)("img",{alt:"Result",src:(0,a.Z)("img/emulators-logo.jpg")}),(0,o.kt)("h2",{id:"implementing-the-test"},"Implementing the test"),(0,o.kt)("p",null,"To run this test we should use ",(0,o.kt)("inlineCode",{parentName:"p"},"emulators.js")," (from emulators) and use our ",(0,o.kt)("inlineCode",{parentName:"p"},"js-dos bundle")," to start the test."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<script src="/v7/build/releases/latest/emulators/emulators.js"><\/script>\n// ...\n<script>\n  emulators.pathPrefix = "/v7/build/releases/latest/emulators/";\n')),(0,o.kt)("p",null,"You can start test in ",(0,o.kt)("a",{parentName:"p",href:"/v7/build/docs/dosbox-worker"},"worker")," or ",(0,o.kt)("a",{parentName:"p",href:"/v7/build/docs/dosbox-direct"},"direct")," mode:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// promise is resolved when emulator is started\nconst ci = await (options.worker ?\n  emulators.dosWorker(bundle) :\n  emulators.dosDirect(bundle));\n")),(0,o.kt)("p",null,"In worker mode each test will run in a new worker. If you press ",(0,o.kt)("inlineCode",{parentName:"p"},"Start Worker")," multiple times,\nthen you will see output from multiple threads. In direct mode the browser will probably hangs.\nIn theory direct mode is faster, but browser will be unstable. Our recommendation is to use worker\nmode all time."),(0,o.kt)("p",null,"Complete example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="examples/dhry2.html"',title:'"examples/dhry2.html"'},"{}\n")))}c.isMDXComponent=!0}}]);